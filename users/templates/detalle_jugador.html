{% extends 'base.html' %}
{% load static %}

{% block title %}Wolves - Clan de Gaming | Perfil de {{ user.nickname }}{% endblock %}

{% block meta_description %}Perfil de {{ user.nickname }} en el clan Wolves. Consulta estadísticas, logros y actividad en el clan.{% endblock %}

{% block content %}
<div class="space-top"></div>
<section class="space profile-section">
    <div class="container">
        <div class="row gy-80">
            <!-- Columna Izquierda: Avatar e Información principal -->
            <div class="col-xl-6">
                <div class="about-card-img">
                    {% if user.profile_image %}
                        <img src="{{ user.profile_images.url }}" alt="{{ user.nickname }}" class="profile-image">
                    {% else %}
                        <div class="profile-image-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                    
                    <!-- Estado de actividad -->
                    <div class="status-indicator {{ user.perfil.estado_actividad|lower }}" title="{{ user.perfil.get_estado_actividad_display }}">
                        <span class="status-dot"></span>
                    </div>
                    
                    <!-- Nivel del jugador -->
                    <div class="player-level">
                        <span>{{ user.perfil.nivel }}</span>
                    </div>
                </div>
                
                <div class="team-about-card mt-30">
                    <div class="title-area mb-0">
                        <span class="sub-title"># Perfil de jugador</span>
                        <h2 class="sec-title d-flex align-items-center flex-wrap">
                            <div class="space-top"></div>
                            {{ user.nickname }}
                            {% if user.perfil.verificado %}
                                <i class="fas fa-check-circle verified-icon ms-2" title="Verificado"></i>
                            {% endif %}
                            
                            <!-- Badges e insignias junto al nickname -->
                            <div class="profile-badges d-inline-flex ms-3">
                                {% if user.perfil.rol_especial != 'NONE' %}
                                <div class="badge role-badge" data-tooltip="{{ user.perfil.get_descripcion_rol }}">
                                    <div class="badge-icon">
                                        <i class="fas fa-{% if user.perfil.rol_especial == 'FOUNDER' %}crown{% elif user.perfil.rol_especial == 'VETERAN' %}medal{% elif user.perfil.rol_especial == 'RECRUITER' %}user-plus{% elif user.perfil.rol_especial == 'CONTENT' %}video{% elif user.perfil.rol_especial == 'MODERATOR' %}shield-alt{% else %}users{% endif %}"></i>
                                    </div>
                                    <span>{{ user.perfil.get_rol_especial_display }}</span>
                                </div>
                                {% endif %}
                                
                                <div class="badge rank-badge" data-tooltip="Rango actual">
                                    <div class="badge-icon">
                                        <i class="fas fa-{% if user.perfil.rango == 'RECRUIT' %}chess-pawn{% elif user.perfil.rango == 'SILVER' %}chess-knight{% elif user.perfil.rango == 'GOLD' %}chess-bishop{% elif user.perfil.rango == 'PLATINUM' %}chess-rook{% elif user.perfil.rango == 'DIAMOND' %}chess-queen{% elif user.perfil.rango == 'MASTER' %}chess-king{% else %}user-shield{% endif %}"></i>
                                    </div>
                                    <span>{{ user.perfil.get_rango_display }}</span>
                                </div>
                                
                                <div class="badge specialty-badge" data-tooltip="Especialidad">
                                    <div class="badge-icon">
                                        <i class="fas fa-{% if user.perfil.especialidad == 'SUPPORT' %}hands-helping{% elif user.perfil.especialidad == 'TACTICAL' %}chess{% elif user.perfil.especialidad == 'SNIPER' %}crosshairs{% elif user.perfil.especialidad == 'ASSAULT' %}running{% elif user.perfil.especialidad == 'RECON' %}binoculars{% elif user.perfil.especialidad == 'MEDIC' %}first-aid{% else %}shield-alt{% endif %}"></i>
                                    </div>
                                    <span>{{ user.perfil.get_especialidad_display }}</span>
                                </div>
                                
                                {% if user.is.lider %}
                                <div class="badge subleader-badge" data-tooltip="Sublíder del clan">
                                    <div class="badge-icon"><i class="fas fa-crown"></i></div>
                                    <span>Liader</span>
                                </div>
                                {% endif %}
                            </div>
                        </h2>
                        
                        <!-- Emblema del clan -->
                        {% if user.perfil.clan %}
                            <div class="clan-tag mt-10">
                                <a href="{% url 'detalle_clan' user.perfil.clan.slug %}" title="{{ user.perfil.clan.nombre }}">
                                    <img src="{{ user.perfil.clan.emblema.url }}" alt="{{ user.perfil.clan.tag }}" class="clan-emblem">
                                    <span>[{{ user.perfil.clan.tag }}]</span>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Estado personalizado -->
                    {% if user.perfil.estado_personalizado %}
                        <p class="about-card_text mt-30 mb-25">
                            <i class="fas fa-quote-left me-2 text-theme opacity-50"></i>
                            {{ user.perfil.estado_personalizado }}
                            <i class="fas fa-quote-right ms-2 text-theme opacity-50"></i>
                        </p>
                    {% endif %}
                    
                    <!-- Información del jugador -->
                    <div class="team-info-list">
                        <ul>
                            <li>Rango: 
                                <span>
                                    <i class="fas fa-{% if user.perfil.rango == 'RECRUIT' %}chess-pawn{% elif user.perfil.rango == 'SILVER' %}chess-knight{% elif user.perfil.rango == 'GOLD' %}chess-bishop{% elif user.perfil.rango == 'PLATINUM' %}chess-rook{% elif user.perfil.rango == 'DIAMOND' %}chess-queen{% elif user.perfil.rango == 'MASTER' %}chess-king{% else %}user-shield{% endif %} me-1 rank-icon"></i>
                                    {{ user.perfil.get_rango_display }}
                                </span>
                            </li>
                            <li>Especialidad: <span>{{ user.perfil.get_especialidad_display }}</span></li>
                            <li>Puntos de honor: <span>{{ user.perfil.puntos_honor }}</span></li>
                            <li>Puntos de experiencia: <span>{{ user.perfil.puntos_exp }}</span></li>

                            <li>Miembro desde: <span>{{ user.date_joined|date:"d/m/Y" }}</span></li>
                        </ul>
                    </div>
                    
                    <!-- Redes sociales -->
                    <div class="team-social mt-25">
                        <h5 class="fw-semibold text-white">Sígueme <span class="text-theme">en:</span></h5>
                        <div class="th-social style-mask">
                            {% if user.twitch_username %}
                                <a class="twitch" href="https://twitch.tv/{{ user.twitch_username }}" target="_blank" title="Twitch">
                                    <i class="fab fa-twitch"></i>
                                </a>
                            {% endif %}
                            
                            {% if user.youtube_channel %}
                                <a class="youtube" href="{{ user.youtube_channel }}" target="_blank" title="YouTube">
                                    <i class="fab fa-youtube"></i>
                                </a>
                            {% endif %}
                            
                            {% if user.twitter_username %}
                                <a class="twitter" href="https://twitter.com/{{ user.twitter_username }}" target="_blank" title="Twitter">
                                    <i class="fab fa-twitter"></i>
                                </a>
                            {% endif %}
                            
                            {% if user.instagram_username %}
                                <a class="instagram" href="https://instagram.com/{{ user.instagram_username }}" target="_blank" title="Instagram">
                                    <i class="fab fa-instagram"></i>
                                </a>
                            {% endif %}
                            
                            {% if user.show_discord and user.discord_id %}
                                <a class="discord" href="#" title="Discord: {{ user.discord_id }}" id="copyDiscord" data-discord="{{ user.discord_id }}">
                                    <i class="fab fa-discord"></i>
                                </a>
                            {% endif %}
                            
                            {% if user.show_email %}
                                <a class="email" href="mailto:{{ user.email }}" title="Email">
                                    <i class="fas fa-envelope"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>    
            </div>
            
            <!-- Columna Derecha: Acciones, Progreso y Logros -->
            <div class="col-xl-6">
                <!-- Acciones del perfil -->
                <div class="profile-actions-wrapper d-flex justify-content-between align-items-center mb-30">
                    {% if request.user == user %}
                        <div class="dropdown">
                            <button class="th-btn style2 action-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-cog me-2"></i>Opciones
                            </button>
                            <ul class="dropdown-menu shadow-lg">
                                <li><a class="dropdown-item" href="{% url 'editar_perfil' %}"><i class="fas fa-user-edit me-2"></i>Editar perfil</a></li>
                                <li><a class="dropdown-item" href="#" onclick="toggleConfigPanel(true, 'privacy-tab'); return false;"><i class="fas fa-lock me-2"></i>Privacidad</a></li>
                                <li><a class="dropdown-item" href="#" onclick="toggleConfigPanel(true, 'achievements-tab'); return false;"><i class="fas fa-trophy me-2"></i>Mis Logros</a></li>
                                <li><a class="dropdown-item" href="#" onclick="toggleConfigPanel(true, 'stats-tab'); return false;"><i class="fas fa-chart-line me-2"></i>Estadísticas</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-sign-out-alt me-2"></i>Cerrar sesión</a></li>
                            </ul>
                        </div>
                    {% else %}
                        <div class="d-flex gap-2">
                            <button class="th-btn {% if user in request.user.amigos.all %}style3{% endif %}" id="btnAddFriend">
                                <i class="fas {% if user in request.user.amigos.all %}fa-user-check{% else %}fa-user-plus{% endif %} me-2"></i>
                                {% if user in request.user.amigos.all %}Amigos{% else %}Agregar{% endif %}
                            </button>
                            <button class="th-btn style2" id="btnSendMessage">
                                <i class="fas fa-envelope me-2"></i>Mensaje
                            </button>
                            <button class="th-btn style4" id="btnChallenge">
                                <i class="fas fa-gamepad me-2"></i>Retar
                            </button>
                        </div>
                        <div class="dropdown">
                            <button class="th-btn style2" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><button class="dropdown-item" id="btnBlock"><i class="fas fa-ban me-2"></i>Bloquear</button></li>
                                <li><button class="dropdown-item" id="btnReport"><i class="fas fa-flag me-2"></i>Reportar</button></li>
                                <li><button class="dropdown-item" id="btnShare"><i class="fas fa-share-alt me-2"></i>Compartir</button></li>
                            </ul>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Panel de Configuración (inicialmente oculto) -->
                <div id="configurationPanel" class="team-about-card mt-30" style="display: none;">
                    <div class="title-area mb-20">
                        <span class="sub-title"># Configuración de la cuenta</span>
                        <h3 class="text-white">Ajustes del perfil</h3>
                    </div>
                    
                    <!-- Pestañas de configuración -->
                    <ul class="nav nav-tabs config-tabs mb-30" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">
                                <i class="fas fa-cog me-2"></i>General
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="privacy-tab" data-bs-toggle="tab" data-bs-target="#privacy" type="button" role="tab" aria-controls="privacy" aria-selected="true">
                                <i class="fas fa-lock me-2"></i>Privacidad
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="achievements-tab" data-bs-toggle="tab" data-bs-target="#achievements" type="button" role="tab" aria-controls="achievements" aria-selected="true">
                                <i class="fas fa-trophy me-2"></i>Logros
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab" aria-controls="stats" aria-selected="true">
                                <i class="fas fa-chart-line me-2"></i>Estadísticas
                            </button>
                        </li>
                    </ul>
                    
                    <!-- Contenido de las pestañas -->
                    <div class="tab-content">
                        <!-- Configuración General -->
                        <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                            <form class="config-form">
                                <div class="form-group mb-20">
                                    <label for="nickname" class="form-label text-white">Nickname</label>
                                    <input type="text" class="form-control" id="nickname" value="{{ user.nickname }}">
                                </div>
                                
                                <div class="form-group mb-20">
                                    <label for="lv_audi" class="form-label text-white">Nivel de audition</label>
                                    <input type="number" class="form-control" id="lv_audi" value="{{ user.perfil.lv_audi }}">
                                </div>
                                
                                <div class="form-group mb-20">
                                    <label for="estado_cpl" class="form-label text-white">Estado de tu couple</label>
                                    <input type="text" class="form-control" id="estado_cpl" value="{{ user.perfil.estado_cpl }}">
                                </div>
                                
                                <div class="form-group mb-20">
                                    <label for = celular class="form-label text-white">Celular</label>
                                    <input type="text" class="form-control" id="celular" value="{{ user.celular }}">
                                </div>
                                <div class="form-group mb-20">
                                    <label for = "profile_image" class="form-label text-white">Imagen de perfil</label>
                                    <input type="file" class="form-control" id="profile_image" value="{{ user.perfil.profile_image }}">
                                </div>
                                
                                <div class="form-group mb-20">
                                    <label class="form-label text-white">Redes sociales</label>
                                    
                                    <div class="input-group mb-2">
                                        <span class="input-group-text"><i class="fab fa-discord"></i></span>
                                        <input type="text" class="form-control" placeholder="ID de Discord" value="{{ user.discord_id }}">
                                    </div>
                                    
                          
                                </div>
                                
                                <div class="button-group">
                                    <button type="submit" class="th-btn">Guardar cambios</button>
                                    <button type="button" class="th-btn style2" onclick="toggleConfigPanel(false)">Cancelar</button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Configuración de Privacidad -->
                        <div class="tab-pane fade" id="privacy" role="tabpanel" aria-labelledby="privacy-tab">
                            <form class="config-form">
                                <div class="form-group mb-20">
                                    <label class="form-label text-white">Visibilidad del perfil</label>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="profileVisibility" id="profilePublic" {% if user.perfil.privacidad_perfil == "PUBLIC" %}checked{% endif %}>
                                        <label class="form-check-label" for="profilePublic">
                                            <i class="fas fa-globe me-2"></i> Público - Todos pueden ver tu perfil
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="profileVisibility" id="profileFriends" {% if user.perfil.privacidad_perfil == "FRIENDS" %}checked{% endif %}>
                                        <label class="form-check-label" for="profileFriends">
                                            <i class="fas fa-user-friends me-2"></i> Amigos - Solo tus amigos pueden ver tu perfil
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="profileVisibility" id="profilePrivate" {% if user.perfil.privacidad_perfil == "PRIVATE" %}checked{% endif %}>
                                        <label class="form-check-label" for="profilePrivate">
                                            <i class="fas fa-lock me-2"></i> Privado - Nadie puede ver tu perfil
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group mb-20">
                                    <label class="form-label text-white">Información de contacto</label>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="showEmail" {% if user.show_email %}checked{% endif %}>
                                        <label class="form-check-label" for="showEmail">
                                            Mostrar email
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="showDiscord" {% if user.show_discord %}checked{% endif %}>
                                        <label class="form-check-label" for="showDiscord">
                                            Mostrar Discord
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group mb-20">
                                    <label class="form-label text-white">Actividad</label>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="showActivity" {% if user.perfil.mostrar_actividad %}checked{% endif %}>
                                        <label class="form-check-label" for="showActivity">
                                            Mostrar mi actividad en el clan
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="showLastSeen" {% if user.perfil.mostrar_ultima_conexion %}checked{% endif %}>
                                        <label class="form-check-label" for="showLastSeen">
                                            Mostrar última conexión
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="button-group">
                                    <button type="submit" class="th-btn">Guardar cambios</button>
                                    <button type="button" class="th-btn style2" onclick="toggleConfigPanel(false)">Cancelar</button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Gestión de Logros -->
                        <div class="tab-pane fade" id="achievements" role="tabpanel" aria-labelledby="achievements-tab">
                            <div class="achievements-dashboard">
                                <div class="stats-summary mb-20">
                                    <div class="stat-box">
                                        <div class="stat-value">{{ user.logros.count }}</div>
                                        <div class="stat-label">Total de logros</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value">{{ user.logros_recientes.count }}</div>
                                        <div class="stat-label">Recientes</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value">{{ user.perfil.porcentaje_logros }}%</div>
                                        <div class="stat-label">Completados</div>
                                    </div>
                                </div>
                                
                                <div class="achievement-list">
                                    {% for logro in user.logros.all %}
                                    <div class="achievement-item">
                                        <div class="achievement-icon">
                                            <i class="{{ logro.icono }}"></i>
                                        </div>
                                        <div class="achievement-info">
                                            <h5>{{ logro.nombre }}</h5>
                                            <p>{{ logro.descripcion }}</p>
                                            <div class="achievement-date">Desbloqueado: {{ logro.fecha_desbloqueo|date:"d/m/Y" }}</div>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="achievement-empty">
                                        <i class="fas fa-trophy text-theme opacity-25 fs-1"></i>
                                        <p>No has desbloqueado ningún logro aún</p>
                                        <a href="#" class="th-btn style3 mt-10">Descubrir logros</a>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <div class="button-group mt-20">
                                    <button type="button" class="th-btn style2" onclick="toggleConfigPanel(false)">Volver al perfil</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Estadísticas detalladas -->
                        <div class="tab-pane fade" id="stats" role="tabpanel" aria-labelledby="stats-tab">
                            <div class="stats-dashboard">
                                <div class="stats-summary mb-30">
                                    <div class="stat-box">
                                        <div class="stat-value">{{ user.stats.matches_played|default:'0' }}</div>
                                        <div class="stat-label">Partidas</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value">{{ user.stats.win_rate|default:'0' }}%</div>
                                        <div class="stat-label">Victorias</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value">{{ user.stats.kd_ratio|default:'0.0' }}</div>
                                        <div class="stat-label">K/D Ratio</div>
                                    </div>
                                </div>
                                
                                <!-- Gráfico de rendimiento -->
                                <div class="performance-chart mb-30">
                                    <h5 class="text-white mb-10">Rendimiento reciente</h5>
                                    <div class="chart-container">
                                        <canvas id="performanceChart" height="200"></canvas>
                                    </div>
                                </div>
                                
                                <!-- Estadísticas detalladas -->
                                <div class="detailed-stats">
                                    <h5 class="text-white mb-15">Estadísticas detalladas</h5>
                                    
                                    <div class="stats-grid">
                                        <div class="stat-item">
                                            <div class="stat-label">Muertes totales</div>
                                            <div class="stat-value">{{ user.stats.deaths|default:'0' }}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Bajas totales</div>
                                            <div class="stat-value">{{ user.stats.kills|default:'0' }}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Asistencias</div>
                                            <div class="stat-value">{{ user.stats.assists|default:'0' }}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Partidas ganadas</div>
                                            <div class="stat-value">{{ user.stats.victories|default:'0' }}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Partidas perdidas</div>
                                            <div class="stat-value">{{ user.stats.losses|default:'0' }}</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Tiempo jugado</div>
                                            <div class="stat-value">{{ user.stats.hours_played|default:'0' }}h</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="button-group mt-30">
                                    <button type="button" class="th-btn style2" onclick="toggleConfigPanel(false)">Volver al perfil</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Contenido normal del perfil (se oculta cuando se muestra la configuración) -->
                <div id="profileContent">
                    <!-- Contenido existente del perfil (Progreso de Rango, etc.) -->
                    <h3 class="text-white mt-n2 mb-20">Progreso de Rango</h3>
                    <div class="skill-feature">
                        <h3 class="skill-feature_title">
                            {{ user.perfil.get_rango_display }}
                            <span class="skill-feature_subtitle">Próximo: {{ user.perfil.get_siguiente_rango_display }}</span>
                        </h3>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: {{ user.perfil.get_progress_percent }}%"></div>
                        </div>
                        <div class="progress-value-wrap">
                            <div class="progress-value">XP <span>{{ user.perfil.puntos_honor }}</span> / {{ user.perfil.puntos_siguiente_rango }}</div>
                            <div class="progress-value draw">Días <span>{{ user.perfil.dias_en_clan }}</span></div>
                        </div>
                    </div>
                    
                    <!-- Estadísticas del jugador -->
                    <div class="skill-feature">
                        <h3 class="skill-feature_title">
                            Rendimiento
                            <span class="skill-feature_subtitle">Estadísticas</span>
                        </h3>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: {{ user.stats.win_rate|default:'0' }}%"></div>
                            <div class="progress-bar lose" role="progressbar" style="width: {{ user.stats.loss_rate|default:'0' }}%"></div>
                        </div>
                        <div class="progress-value-wrap">
                            <div class="progress-value">VICTORIAS <span class="counter-number">{{ user.stats.victories|default:'0' }}</span></div>
                            <div class="progress-value draw">K/D <span>{{ user.stats.kd_ratio|default:'0.0' }}</span></div>
                            <div class="progress-value lose">DERROTAS <span class="counter-number">{{ user.stats.losses|default:'0' }}</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Scroll To Top -->
<div class="scroll-top">
    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" style="transition: stroke-dashoffset 10ms linear 0s; stroke-dasharray: 307.919, 307.919; stroke-dashoffset: 307.919;"></path>
    </svg>
</div>

<!-- JavaScript para manejar el panel de configuración -->
<script>
  function toggleConfigPanel(showPanel = true, tabId = null) {
    const configPanel = document.getElementById('configurationPanel');
    const profileContent = document.getElementById('profileContent');
    
    // Mostrar u ocultar el panel según el parámetro
    if (showPanel) {
      configPanel.style.display = 'block';
      profileContent.style.display = 'none';
      
      // Si se especificó un tabId, activar esa pestaña
      if (tabId) {
        document.getElementById(tabId).click();
      }
    } else {
      configPanel.style.display = 'none';
      profileContent.style.display = 'block';
    }
  }
  
  // Vincular el botón de editar perfil al panel de configuración
  document.addEventListener('DOMContentLoaded', function() {
    const editProfileBtn = document.querySelector('.action-btn.edit-profile');
    if (editProfileBtn) {
      editProfileBtn.addEventListener('click', function(e) {
        e.preventDefault();
        toggleConfigPanel(true, 'general-tab');
      });
    }
    
    // Configurar los botones del menú desplegable
    const configMenuItem = document.querySelector('a.dropdown-item i.fa-cog').parentElement;
    if (configMenuItem) {
      configMenuItem.addEventListener('click', function(e) {
        e.preventDefault();
        toggleConfigPanel(true, 'general-tab');
      });
    }
    
    const privacyMenuItem = document.querySelector('a.dropdown-item i.fa-lock').parentElement;
    if (privacyMenuItem) {
      privacyMenuItem.addEventListener('click', function(e) {
        e.preventDefault();
        toggleConfigPanel(true, 'privacy-tab');
      });
    }
    
    const achievementsMenuItem = document.querySelector('a.dropdown-item i.fa-trophy').parentElement;
    if (achievementsMenuItem) {
      achievementsMenuItem.addEventListener('click', function(e) {
        e.preventDefault();
        toggleConfigPanel(true, 'achievements-tab');
      });
    }
    
    const statsMenuItem = document.querySelector('a.dropdown-item i.fa-chart-line').parentElement;
    if (statsMenuItem) {
      statsMenuItem.addEventListener('click', function(e) {
        e.preventDefault();
        toggleConfigPanel(true, 'stats-tab');
      });
    }
    
    // Configurar el botón Cancelar para volver al perfil
    const cancelButtons = document.querySelectorAll('.th-btn.style2[onclick="toggleConfigPanel()"]');
    cancelButtons.forEach(button => {
      button.setAttribute('onclick', 'toggleConfigPanel(false)');
    });
    
    // Inicializar el gráfico de rendimiento si estamos en la pestaña de estadísticas
    document.getElementById('stats-tab').addEventListener('shown.bs.tab', function() {
      initPerformanceChart();
    });
  });
  
  // Función para inicializar el gráfico de rendimiento
  function initPerformanceChart() {
    const ctx = document.getElementById('performanceChart');
    
    // Si ya existe un gráfico, destruirlo para evitar duplicados
    if (window.performanceChart) {
      window.performanceChart.destroy();
    }
    
    // Datos de ejemplo (reemplazar con datos reales del usuario)
    const labels = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'];
    const kdData = [1.2, 1.5, 1.3, 1.8, 1.6, 2.0];
    const winRateData = [40, 45, 42, 55, 48, 60];
    
    window.performanceChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          {
            label: 'K/D Ratio',
            data: kdData,
            borderColor: '#00ff75',
            backgroundColor: 'rgba(0, 255, 117, 0.1)',
            tension: 0.4,
            yAxisID: 'y'
          },
          {
            label: 'Win Rate %',
            data: winRateData,
            borderColor: '#ffd700',
            backgroundColor: 'rgba(255, 215, 0, 0.1)',
            tension: 0.4,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: {
              display: true,
              text: 'K/D Ratio'
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            title: {
              display: true,
              text: 'Win Rate %'
            },
            grid: {
              drawOnChartArea: false
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          },
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          }
        }
      }
    });
  }
</script>

<style>
/* Estilos para el panel de configuración */
.config-tabs .nav-link {
    color: rgba(255, 255, 255, 0.7);
    background: transparent;
    border: none;
    padding: 12px 20px;
    border-radius: 0;
    position: relative;
    transition: all 0.3s ease;
}

.config-tabs .nav-link:hover {
    color: var(--wolves-accent);
}

.config-tabs .nav-link.active {
    color: var(--wolves-accent);
    background: rgba(0, 255, 117, 0.1);
}

.config-tabs .nav-link.active:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--wolves-accent);
}

.config-form .form-label {
    margin-bottom: 8px;
    font-weight: 500;
}

.config-form .form-control,
.config-form .form-select {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
}

.config-form .form-control:focus,
.config-form .form-select:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--wolves-accent);
    box-shadow: 0 0 0 3px rgba(0, 255, 117, 0.2);
}

.config-form .input-group-text {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--wolves-accent);
}

.config-form .form-check-input {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
}

.config-form .form-check-input:checked {
    background-color: var(--wolves-accent);
    border-color: var(--wolves-accent);
}

.config-form .form-check-label {
    color: rgba(255, 255, 255, 0.8);
}

.button-group {
    display: flex;
    gap: 10px;
    margin-top: 30px;
}

/* Estilos para la sección de logros */
.stats-summary {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}

.stat-box {
    flex: 1;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--wolves-accent);
    margin-bottom: 5px;
}

.stat-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
}

.achievement-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
}

.achievement-list::-webkit-scrollbar {
    width: 6px;
}

.achievement-list::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
}

.achievement-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
}

.achievement-item {
    display: flex;
    align-items: center;
    gap: 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.achievement-item:hover {
    border-color: var(--wolves-accent);
    background: rgba(0, 0, 0, 0.3);
}

.achievement-icon {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--wolves-accent);
    background: rgba(0, 255, 117, 0.1);
    border-radius: 50%;
    flex-shrink: 0;
}

.achievement-info {
    flex: 1;
}

.achievement-info h5 {
    margin: 0 0 5px;
    color: white;
    font-weight: 600;
}

.achievement-info p {
    margin: 0 0 8px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
}

.achievement-date {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.5);
}

.achievement-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 50px 20px;
    text-align: center;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    border: 1px dashed rgba(255, 255, 255, 0.1);
}

.achievement-empty p {
    margin: 15px 0;
    color: rgba(255, 255, 255, 0.6);
}

/* Estilos para la sección de estadísticas */
.chart-container {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.stat-item {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-item .stat-label {
    margin-bottom: 8px;
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .stats-summary {
        flex-direction: column;
        gap: 10px;
    }
}

/* Estilo para los badges de perfil */
.profile-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
}

.badge {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 10px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
    font-size: 0.75rem;
    font-weight: 600;
    color: #fff;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.badge-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
}

.badge span {
    white-space: nowrap;
}

/* Estilos específicos por tipo de insignia */
.role-badge {
    background: linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(138, 43, 226, 0.1));
    border-color: rgba(138, 43, 226, 0.5);
}

.role-badge .badge-icon {
    color: #8a2be2;
}

.rank-badge {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
    border-color: rgba(255, 215, 0, 0.5);
}

.rank-badge .badge-icon {
    color: #ffd700;
}

.specialty-badge {
    background: linear-gradient(135deg, rgba(0, 255, 117, 0.3), rgba(0, 255, 117, 0.1));
    border-color: rgba(0, 255, 117, 0.5);
}

.specialty-badge .badge-icon {
    color: #00ff75;
}

.subleader-badge {
    background: linear-gradient(135deg, rgba(255, 69, 0, 0.3), rgba(255, 69, 0, 0.1));
    border-color: rgba(255, 69, 0, 0.5);
}

.subleader-badge .badge-icon {
    color: #ff4500;
}

.platform-badge .badge-icon {
    color: #1da1f2;
}

/* Tooltips para las insignias */
[data-tooltip] {
    position: relative;
    cursor: pointer;
}

[data-tooltip]:before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 5px 10px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    border-radius: 4px;
    font-size: 0.7rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    z-index: 100;
}

[data-tooltip]:hover:before {
    opacity: 1;
    bottom: calc(100% + 5px);
}
</style>
{% endblock %}